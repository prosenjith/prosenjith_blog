---
import "../../styles/global.css";
import { getCollection } from "astro:content";

// Pre-generate a page for every tag found in your posts
export async function getStaticPaths() {
  const posts = await getCollection("posts");
  const tags = [...new Set(posts.flatMap(p => p.data.tags ?? []))];
  return tags.map(tag => ({ params: { tag } }));
}

const { tag } = Astro.params;
const posts = (await getCollection("posts"))
  .filter(p => !p.data.draft && (p.data.tags ?? []).includes(tag))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<html lang="en">
  <body class="max-w-3xl mx-auto px-4 py-8">
    <a href="/" class="inline-block text-sm hover:underline">← All posts</a>
    <h1 class="text-3xl font-bold mt-4">Tag: {tag}</h1>
    <ul class="mt-6 space-y-6">
      {posts.map(({ slug, data }) => (
        <li>
          <a href={`/posts/${slug}/`} class="text-xl font-semibold hover:underline">
            {data.title}
          </a>
          <p class="opacity-80">{data.description}</p>
        </li>
      ))}
    </ul>
  </body>
</html>