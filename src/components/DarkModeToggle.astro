---
/* Knob holds the icons so they never get covered; sun/moon cross-fade */
---
<button
  id="theme-toggle"
  type="button"
  role="switch"
  aria-checked="false"
  title="Toggle theme"
  class="relative inline-flex h-9 w-[68px] cursor-pointer items-center rounded-full 
         border border-gray-300 bg-white/90 px-1 transition-all duration-300
         hover:shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2
         focus-visible:ring-gray-400 dark:border-gray-700 dark:bg-gray-900/90
         dark:focus-visible:ring-gray-600"
>
  <!-- Track (for subtle depth) -->
  <span class="absolute inset-0 rounded-full bg-black/[0.02] dark:bg-white/[0.03]"></span>

  <!-- Knob (icons live inside) -->
  <span
    id="knob"
    class="relative z-10 grid h-7 w-7 place-items-center rounded-full bg-gray-100 shadow
           ring-1 ring-black/10 transition-transform duration-300 ease-out
           dark:bg-gray-800 dark:ring-white/10 translate-x-0 dark:translate-x-[32px]"
    aria-hidden="true"
  >
    <!-- Sun -->
    <svg
      class="absolute h-4 w-4 text-amber-500 opacity-100 transition-opacity duration-300 dark:opacity-0"
      viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
    >
      <circle cx="12" cy="12" r="4"></circle>
      <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/>
    </svg>

    <!-- Moon -->
    <svg
      class="absolute h-4 w-4 text-blue-300 opacity-0 transition-opacity duration-300 dark:opacity-100"
      viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
    >
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
    </svg>
  </span>
</button>

<script is:inline>
  (function () {
    const doc = document.documentElement;
    const btn = document.getElementById('theme-toggle');

    // initial state from pre-paint script
    btn.setAttribute('aria-checked', String(doc.classList.contains('dark')));

    function setTheme(dark) {
      doc.classList.toggle('dark', dark);
      try { localStorage.setItem('theme', dark ? 'dark' : 'light'); } catch (_) {}
      btn.setAttribute('aria-checked', String(dark));

      // sync Giscus (if present)
      try {
        document.querySelector('iframe.giscus-frame')
          ?.contentWindow?.postMessage(
            { giscus: { setConfig: { theme: dark ? 'dark' : 'light' } } },
            'https://giscus.app'
          );
      } catch (_) {}
    }

    const toggle = () => setTheme(!doc.classList.contains('dark'));
    btn.addEventListener('click', toggle);
    btn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); }
    });
  })();
</script>
